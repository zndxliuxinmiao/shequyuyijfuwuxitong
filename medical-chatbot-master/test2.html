<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Chat Widget</title>

    <!--图标库-->
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css'>

    <!-- 默认样式-->
    <link rel="stylesheet" href="css/reset.min.css">

    <!-- 主要样式-->
    <link rel="stylesheet" href="css/style.css">


</head>

<body>

    <div class="container clearfix">
        <div class="people-list" id="people-list">
            <div class="search">
                <input type="text" placeholder="search" />
                <i class="fa fa-search"></i>
            </div>
            <ul class="list">
                <li class="clearfix">
                    <img src="img/樱岛麻衣.jpg" alt="avatar" />
                    <div class="about">
                        <div class="name">麻衣学姐</div>
                        <div class="status">
                            <i class="fa fa-circle online"></i> online
                        </div>
                    </div>
                </li>

                <li class="clearfix">
                    <img src="img/akuya.png" alt="avatar" />
                    <div class="about">
                        <div class="name">阿库娅</div>
                        <div class="status">
                            <i class="fa fa-circle offline"></i> left 2 mins ago
                        </div>
                    </div>
                </li>

                <li class="clearfix">
                    <img src="img/trump.jpg" alt="avatar" />
                    <div class="about">
                        <div class="name">特朗普同志</div>
                        <div class="status">
                            <i class="fa fa-circle offline"></i> left 7 mins ago
                        </div>
                    </div>
                </li>

                <li class="clearfix">
                    <img src="img/菜虚鲲.jpg" alt="avatar" />
                    <div class="about">
                        <div class="name">菜虚鲲</div>
                        <div class="status">
                            <i class="fa fa-circle online"></i> online
                        </div>
                    </div>
                </li>

                <li class="clearfix">
                    <img src="img/奥利给.jpg" alt="avatar" />
                    <div class="about">
                        <div class="name">奥利给</div>
                        <div class="status">
                            <i class="fa fa-circle online"></i> online
                        </div>
                    </div>
                </li>


                <li class="clearfix">
                    <img src="img/violet.png" alt="avatar" />
                    <div class="about">
                        <div class="name">Violet</div>
                        <div class="status">
                            <i class="fa fa-circle offline"></i> left 30 mins ago
                        </div>
                    </div>
                </li>


                <li class="clearfix">
                    <img src="img/周董.jpg" alt="avatar" />
                    <div class="about">
                        <div class="name">周董</div>
                        <div class="status">
                            <i class="fa fa-circle online"></i> online
                        </div>
                    </div>
                </li>

                <li class="clearfix">
                    <img src="img/李云龙.jpg" alt="avatar" />
                    <div class="about">
                        <div class="name">李云龙</div>
                        <div class="status">
                            <i class="fa fa-circle online"></i> online
                        </div>
                    </div>
                </li>

                <li class="clearfix">
                    <img src="img/明哥.jpeg" alt="avatar" />
                    <div class="about">
                        <div class="name">明哥</div>
                        <div class="status">
                            <i class="fa fa-circle online"></i> online
                        </div>
                    </div>
                </li>
            </ul>
        </div>

        <div class="chat">
            <div class="chat-header clearfix">
                <img src="img/樱岛麻衣.jpg" alt="avatar" />

                <div class="chat-about">
                    <div class="chat-with">医疗小助手</div>
                    <div class="chat-num-messages">already 1 902 messages</div>
                </div>
                <i class="fa fa-star"></i>
            </div>
            <!-- end chat-header -->

            <div class="chat-history">
                <ul>
                    <li class="clearfix">
                        <div class="message-data align-right">
                            <span class="message-data-time">10:10 AM, Today</span> &nbsp; &nbsp;
                            <span class="message-data-name">Zhang J.F</span> <i class="fa fa-circle me"></i>

                        </div>
                        <div class="message other-message float-right">
                            简单的介绍一下自己呗
                        </div>
                    </li>

                    <li>
                        <div class="message-data">
                            <span class="message-data-name"><i class="fa fa-circle online"></i> 医疗小助手</span>
                            <span class="message-data-time">10:12 AM, Today</span>
                        </div>
                        <div class="message my-message">
                            您好，我是您的医疗小助手，配备有基于知识图谱+bert文本相似度+seq2seq模型搭建的问答系统。你可以对我进行心理咨询，问诊等哦~
                        </div>
                    </li>

                </ul>

            </div>
            <!-- end chat-history -->

            <div class="chat-message clearfix">
                <textarea name="message-to-send" id="message-to-send" placeholder="Type your message" rows="3"></textarea>

                <i class="fa fa-file-o"></i> &nbsp;&nbsp;&nbsp;
                <i class="fa fa-file-image-o"></i>

                <button>Send</button>

            </div>
            <!-- end chat-message -->

        </div>
        <!-- end chat -->
        <div>
            <input type="button" onclick="startRec()" value="开始录音">
            <hr>
            <input type="button" onclick="playRec()" value="结束并播放">
            <input type="button" onclick="uploadRec()" value="结束并上传">
        </div>

    </div>
    <!-- end container -->

    <!--这一块提问题-->
    <script id="message-template" type="text/x-handlebars-template">
        <li class="clearfix">
            <div class="message-data align-right">
                <span class="message-data-time">{{time}}, Today</span> &nbsp; &nbsp;
                <span class="message-data-name">Zhang J.F</span> <i class="fa fa-circle me"></i>
            </div>
            <div class="message other-message float-right">
                {{messageOutput}}
            </div>
        </li>
    </script>

    <!--这一块回答问题-->
    <script id="message-response-template" type="text/x-handlebars-template">
        <li>
            <div class="message-data">
                <span class="message-data-name"><i class="fa fa-circle online"></i> 您的小助手</span>
                <span class="message-data-time">{{time}}, Today</span>
            </div>
            <div class="message my-message" data-state="{{state}}">
                {{response}}<img src="{{imgurl}}" class="myimg" >
            </div>
        </li>
    </script>
    <script src="https://xiangyuecn.github.io/Recorder/recorder.mp3.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js">
    </script>
    <script type="text/javascript" src='js/handlebars.min.js'></script>
    <script type="text/javascript" src='js/list.min.js'></script>
    <script type="text/javascript" src="js/script.js"></script>
    <script>
        var rec;
        function startRec(){
            rec=Recorder();//使用默认配置，mp3格式
            
            //打开麦克风授权获得相关资源
            rec.open(function(){
                //开始录音
                rec.start();
            },function(msg,isUserNotAllow){
                //用户拒绝了权限或浏览器不支持
                alert((isUserNotAllow?"用户拒绝了权限，":"")+"无法录音:"+msg);
            });
        };
        </script>
        
        <script>
            function uploadRec(){
                //停止录音，得到了录音文件blob二进制对象，想干嘛就干嘛
                rec.stop(function(blob,duration){
                    /*
                    blob文件对象，可以用FileReader读取出内容
                    ，或者用FormData上传，本例直接上传二进制文件
                    ，对于普通application/x-www-form-urlencoded表单上传
                    ，请参考github里面的例子
                    */
                    var form=new FormData();
                    form.append("upfile",blob,"recorder.mp3"); //和普通form表单并无二致，后端接收到upfile参数的文件，文件名为recorder.mp3
                    
                    //直接用ajax上传
                    var xhr=new XMLHttpRequest();
                    xhr.open("POST","http://baidu.com/修改成你的上传地址");//这个假地址在控制台network中能看到请求数据和格式，请求结果无关紧要
                    xhr.onreadystatechange=function(){
                        if(xhr.readyState==4){
                            alert(xhr.status==200?"上传成功":"测试请先打开浏览器控制台，然后重新录音，在network选项卡里面就能看到上传请求数据和格式了");
                        }
                    }
                    xhr.send(form);
                },function(msg){
                    alert("录音失败:"+msg);
                });
            };</script>
        
        <script>
            function playRec(){
                //停止录音，得到了录音文件blob二进制对象，想干嘛就干嘛
                rec.stop(function(blob,duration){
                    var audio=document.createElement("audio");
                    audio.controls=true;
                    document.body.appendChild(audio);
                    
                    //非常简单的就能拿到blob音频url
                    audio.src=URL.createObjectURL(blob);
                    audio.play();
                },function(msg){
                    alert("录音失败:"+msg);
                });
            };</script></body>

</html>